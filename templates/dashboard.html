<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="position: relative; min-height: 100vh;">
    <!-- Persistent Agriculture Background Video -->
    <video autoplay loop muted playsinline id="bg-video" style="position: fixed; left: 0; top: 0; min-width: 100vw; min-height: 100vh; object-fit: cover; z-index: -2;">
        <source src="https://agricoop.gov.in/sites/default/files/video/PM_Kisan.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <!-- Persistent Agriculture Image Overlay -->
    <img src="https://agricoop.gov.in/sites/default/files/inline-images/Agriculture-Logo.png" alt="Agriculture Department of India" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: contain; opacity: 0.12; z-index: -1; pointer-events: none;" />
    {% include 'navbar.html' %}
    <div class="container py-5">
        <h2 class="mb-4">Welcome, {{ current_user.username }}!</h2>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Crop Advisory</h5>
                        <form method="post" class="row g-2 mb-3">
                            <div class="col-md-6">
                                <label for="season" class="form-label">Season</label>
                                <select class="form-select" id="season" name="season">
                                    {% for s in seasons %}
                                    <option value="{{ s }}" {% if s == selected_season %}selected{% endif %}>{{ s }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="soil" class="form-label">Soil Type</label>
                                <select class="form-select" id="soil" name="soil">
                                    {% for soil in soils %}
                                    <option value="{{ soil }}" {% if soil == selected_soil %}selected{% endif %}>{{ soil }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12 mt-2">
                                <button type="submit" class="btn btn-success">Show Advisory</button>
                            </div>
                        </form>
                        <div class="mb-2">
                            <strong>Recommended Crops:</strong>
                            <ul>
                                {% for crop in advisory.crops %}
                                <li>{{ crop }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div><strong>Tips:</strong> {{ advisory.tips }}</div>
                        <a href="/helpdesk" class="btn btn-outline-success mt-2">Ask an Expert</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
<form class="row g-3 mb-4" method="get" action="/dashboard">
    <div class="col-auto">
        <input type="text" class="form-control" name="city" placeholder="Enter city or village" value="{{ city }}">
    </div>
    <div class="col-auto">
        <button type="submit" class="btn btn-success mb-3">Get Weather</button>
    </div>
</form>
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Current Weather</h5>
        {% if weather %}
        <div class="d-flex align-items-center">
            <img src="https://openweathermap.org/img/wn/{{ weather.icon }}@2x.png" alt="Weather icon" style="width:60px;height:60px;">
            <div class="ms-3">
                <h5 class="card-title">{{ weather.city }}</h5>
                <p class="mb-1">{{ weather.temp }}&deg;C, {{ weather.desc }}</p>
                <p class="mb-1">Humidity: {{ weather.humidity }}%</p>
                <p class="mb-1">Wind Speed: {{ weather.wind }} m/s</p>
            </div>
        </div>
        {% else %}
        <p class="text-muted">Enter a city name to get weather information</p>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h5 class="card-title">3-Day Weather Forecast</h5>
        {% if forecast and forecast|length > 0 %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Weather</th>
                        <th>Temperature</th>
                        <th>Humidity</th>
                        <th>Wind Speed</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day in forecast %}
                    <tr>
                        <td>{{ day.date }}</td>
                        <td>
                            <img src="https://openweathermap.org/img/wn/{{ day.icon }}.png" alt="{{ day.desc }}" class="weather-icon">
                            <span class="ms-2">{{ day.desc }}</span>
                        </td>
                        <td>{{ day.temp }}&deg;C</td>
                        <td>{{ day.humidity }}%</td>
                        <td>{{ day.wind }} m/s</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">Enter a city name to get weather forecast</p>
        {% endif %}
    </div>
</div>
</body>
</html>
