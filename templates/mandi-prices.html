<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandi Prices</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    {% include 'navbar.html' %}
    <div class="container py-5">
        <h2>Mandi Prices</h2>
        <p>Check daily mandi prices and historical price trends for your crops.</p>
        <div class="row mb-3">
            <div class="col-md-4">
                <input type="text" id="filter-crop" class="form-control" placeholder="Filter by Crop">
            </div>
            <div class="col-md-4">
                <input type="text" id="filter-location" class="form-control" placeholder="Filter by Location">
            </div>
            <div class="col-md-4 text-end">
                <button id="refresh-btn" class="btn btn-primary">Refresh Prices</button>
                <span id="loading-spinner" class="spinner-border spinner-border-sm text-primary d-none" role="status"></span>
            </div>
        </div>
        <table class="table table-bordered table-striped mt-4">
            <thead>
                <tr>
                    <th>Crop</th>
                    <th>Location</th>
                    <th>Price (â‚¹/quintal)</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="mandi-table-body">
                <tr><td>Wheat</td><td>Delhi</td><td>2,300</td><td>2025-05-13</td></tr>
                <tr><td>Wheat</td><td>Lucknow</td><td>2,250</td><td>2025-05-13</td></tr>
                <tr><td>Wheat</td><td>Chandigarh</td><td>2,400</td><td>2025-05-13</td></tr>
                <tr><td>Rice</td><td>Kolkata</td><td>2,800</td><td>2025-05-13</td></tr>
                <tr><td>Rice</td><td>Patna</td><td>2,650</td><td>2025-05-13</td></tr>
                <tr><td>Rice</td><td>Guwahati</td><td>2,700</td><td>2025-05-13</td></tr>
                <tr><td>Maize</td><td>Pune</td><td>1,900</td><td>2025-05-13</td></tr>
                <tr><td>Maize</td><td>Hyderabad</td><td>2,000</td><td>2025-05-13</td></tr>
                <tr><td>Maize</td><td>Bangalore</td><td>1,950</td><td>2025-05-13</td></tr>
                <tr><td>Cotton</td><td>Ahmedabad</td><td>6,200</td><td>2025-05-13</td></tr>
                <tr><td>Cotton</td><td>Nagpur</td><td>6,000</td><td>2025-05-13</td></tr>
                <tr><td>Cotton</td><td>Coimbatore</td><td>6,300</td><td>2025-05-13</td></tr>
                <tr><td>Mustard</td><td>Jaipur</td><td>5,100</td><td>2025-05-13</td></tr>
                <tr><td>Mustard</td><td>Kanpur</td><td>5,050</td><td>2025-05-13</td></tr>
                <tr><td>Mustard</td><td>Hisar</td><td>5,200</td><td>2025-05-13</td></tr>
                <tr><td>Soybean</td><td>Indore</td><td>4,300</td><td>2025-05-13</td></tr>
                <tr><td>Soybean</td><td>Bhopal</td><td>4,350</td><td>2025-05-13</td></tr>
                <tr><td>Soybean</td><td>Nanded</td><td>4,250</td><td>2025-05-13</td></tr>
                <tr><td>Chana</td><td>Bhopal</td><td>4,800</td><td>2025-05-13</td></tr>
                <tr><td>Chana</td><td>Raipur</td><td>4,700</td><td>2025-05-13</td></tr>
                <tr><td>Chana</td><td>Jodhpur</td><td>4,850</td><td>2025-05-13</td></tr>
                <tr><td>Sugarcane</td><td>Meerut</td><td>320</td><td>2025-05-13</td></tr>
                <tr><td>Sugarcane</td><td>Kolhapur</td><td>315</td><td>2025-05-13</td></tr>
                <tr><td>Sugarcane</td><td>Gorakhpur</td><td>325</td><td>2025-05-13</td></tr>
                <tr><td>Potato</td><td>Agra</td><td>1,200</td><td>2025-05-13</td></tr>
                <tr><td>Onion</td><td>Nashik</td><td>1,400</td><td>2025-05-13</td></tr>
                <tr><td>Tomato</td><td>Bangalore</td><td>1,800</td><td>2025-05-13</td></tr>
                <tr><td>Apple</td><td>Shimla</td><td>8,000</td><td>2025-05-13</td></tr>
                <tr><td>Banana</td><td>Trichy</td><td>1,100</td><td>2025-05-13</td></tr>
                <tr><td>Tea</td><td>Darjeeling</td><td>20,000</td><td>2025-05-13</td></tr>
                <tr><td>Rubber</td><td>Kottayam</td><td>15,000</td><td>2025-05-13</td></tr>
            </tbody>
        </table>
    </div>
    <script>
        // Filter table rows by crop/location
        document.getElementById('filter-crop').addEventListener('input', filterTable);
        document.getElementById('filter-location').addEventListener('input', filterTable);
        function filterTable() {
            let crop = document.getElementById('filter-crop').value.toLowerCase();
            let loc = document.getElementById('filter-location').value.toLowerCase();
            let rows = document.querySelectorAll('#mandi-table-body tr');
            rows.forEach(row => {
                let cropCell = row.cells[0].textContent.toLowerCase();
                let locCell = row.cells[1].textContent.toLowerCase();
                row.style.display = (cropCell.includes(crop) && locCell.includes(loc)) ? '' : 'none';
            });
        }
        // Real-time refresh (simulate with AJAX to /api/mandi-prices)
        document.getElementById('refresh-btn').addEventListener('click', function() {
            let spinner = document.getElementById('loading-spinner');
            spinner.classList.remove('d-none');
            fetch('/api/mandi-prices')
                .then(resp => resp.json())
                .then(data => {
                    let tbody = document.getElementById('mandi-table-body');
                    tbody.innerHTML = '';
                    data.forEach(row => {
                        tbody.innerHTML += `<tr><td>${row.crop}</td><td>${row.location}</td><td>${row.price}</td><td>${row.date}</td></tr>`;
                    });
                    filterTable();
                })
                .catch(() => alert('Failed to refresh prices.'))
                .finally(() => spinner.classList.add('d-none'));
        });
    </script>
</body>
</html>
